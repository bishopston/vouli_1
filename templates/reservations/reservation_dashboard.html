{% extends '../base/base_admin.html' %}

{% block content %}

    <h1>Reservation Dashboard</h1>

    <!-- School Year Dropdown -->
    <form method="get" action="">
        <label for="school_year">Select School Year:</label>
        <select name="school_year" id="school_year">
            <option value="" {% if not selected_school_year %}selected{% endif %}>-- All --</option>
            {% for year in school_years %}
                <option value="{{ year.id }}" {% if year.id == selected_school_year %}selected{% endif %}>{{ year.name }}</option>
            {% endfor %}
        </select>

        <!-- Reservation Period Dropdown -->
        <label for="reservation_period">Select Reservation Period:</label>
        <select name="reservation_period" id="reservation_period">
            <option value="" {% if not selected_reservation_period %}selected{% endif %}>-- All --</option>
            {% for period in reservation_periods %}
                <option value="{{ period.id }}" {% if period.id == selected_reservation_period %}selected{% endif %}>{{ period.name }}</option>
            {% endfor %}
        </select>

        <!-- Department Dropdown -->
        <label for="department">Select Department:</label>
        <select name="department" id="department">
            <option value="" {% if not selected_department %}selected{% endif %}>-- All --</option>
            {% for dept in departments %}
                <option value="{{ dept.id }}" {% if dept.id == selected_department %}selected{% endif %}>{{ dept.name }}</option>
            {% endfor %}
        </select>

        <!-- School User Dropdown -->
        <label for="school_user">Select School User:</label>
        <select name="school_user" id="school_user">
            <option value="" {% if not selected_school_user %}selected{% endif %}>-- All --</option>
            {% for user in school_users %}
                <option value="{{ user.id }}" {% if user.id == selected_school_user %}selected{% endif %}>{{ user.school.name }}</option>
            {% endfor %}
        </select>

        <button type="submit">Filter</button>
    </form>

    <!-- Display Historical Reservations -->
    <h2>Historical Reservations</h2>
    {% if historical_reservations %}
        <ul>
            {% for reservation in historical_reservations %}
                <li>{{ reservation.reservation_date }} - {{ reservation.schoolUser }} - {{ reservation.status }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No historical reservations found.</p>
    {% endif %}

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script>
        $(document).ready(function() {
            $('#school_year').change(function() {
                var selectedSchoolYearId = $(this).val();
    
                $.ajax({
                    url: '{% url "reservations:get_reservation_periods" %}',
                    data: {
                        'school_year_id': selectedSchoolYearId
                    },
                    dataType: 'json',  // Expect JSON response
                    success: function(data) {
                        if (data.options) {
                            $('#reservation_period').html(data.options);
                        } else {
                            console.error('No options returned in the response.');
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error('AJAX request failed:', textStatus, errorThrown);
                    }
                });
            });
        });
    </script>


    <script>
        $(document).ready(function () {
            // Existing code...

            // Add an event listener for the department dropdown
            $('#reservation_period').change(function () {
                var selectedReservationPeriodId = $(this).val();

                $.ajax({
                    url: '{% url "reservations:get_departments" %}',
                    data: {
                        'reservation_period_id': selectedReservationPeriodId
                    },
                    dataType: 'json',
                    success: function (data) {
                        if (data.options) {
                            $('#department').html(data.options);
                        } else {
                            console.error('No options returned in the response.');
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.error('AJAX request failed:', textStatus, errorThrown);
                    }
                });
            });
        });
    </script>

<script>
    $(document).ready(function () {
        // Existing code...

        // Add an event listener for the department dropdown
        $('#department').change(function () {
            var selectedDepartmentId = $(this).val();
            var selectedReservationPeriodId = $('#reservation_period').val();

            $.ajax({
                url: '{% url "reservations:get_schoolusers" %}',
                data: {
                    'department_id': selectedDepartmentId,
                    'reservation_period_id': selectedReservationPeriodId
                },
                dataType: 'json',
                success: function (data) {
                    if (data.options) {
                        $('#school_user').html(data.options);
                    } else {
                        console.error('No options returned in the response.');
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error('AJAX request failed:', textStatus, errorThrown);
                }
            });
        });
    });
</script>


{% endblock %}